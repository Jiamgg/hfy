import{_ as N,u as R,r as g,B as z,a as i,o as y,c as D,b as o,w as n,e as _,x as $,z as I,F as H,g as P,h as O,v as q,d,A as J,H as h,E as K,p as Q,l as W}from"./index-062c680d.js";import{s as X}from"./index-93ce57eb.js";function Y(r){return X({url:"http://localhost:81/dev-api/common/uploadMore",method:"post",data:r})}const x=r=>(Q("data-v-700f6164"),r=r(),W(),r),Z={class:"common-layout"},ee=x(()=>d("h2",null,"摄像头",-1)),te=x(()=>d("h3",null,"选定图片区",-1)),ae={ref:"canvas",width:"640",height:"480"},oe=x(()=>d("h3",null,"拍摄区",-1)),ne={ref:"video",width:"640",height:"480",autoplay:""},se={__name:"Camera",setup(r){const k=R(),f=g([]),m=g(!1),w=g(!0),C=g(""),{proxy:s}=J();z(()=>{b()});const B=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(t=>{s.$refs.video.srcObject=t,s.$refs.video.play(),m.value=!0}).catch(t=>{h({message:"摄像头开启失败，请检查是否开启权限",type:"warning"})})},j=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:!0});if(C.value=t.id,t){s.$refs.canvas.getContext("2d").drawImage(s.$refs.video,0,0,640,480);let a=s.$refs.canvas.toDataURL("image/jpeg",.7),l=F(a,"摄像头拍摄"),c=new FormData;c.append("files",l),c.append("module",113),Y(c)}}catch(t){h({message:"摄像头开启失败，请检查是否开启权限",type:"warning"});const e=navigator.userAgent;e.indexOf("Chrome")>-1?console.log("chrome://settings/content/camera"):e.indexOf("Firefox")>-1?console.log("firefox://settings/content/camera"):e.indexOf("Safari")>-1?console.log("safari://settings/content/camera"):e.indexOf("Opera")>-1?console.log("opera://settings/content/camera"):e.indexOf("Edge")>-1?console.log("edge://settings/content/camera"):console.log("无法识别的浏览器")}},E=()=>{C.value?K.prompt("请输入此文件的名字","Tip",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:t})=>{let e=document.createElement("a");e.href=s.$refs.canvas.toDataURL("image/jpg",.7),e.download=t+".jpeg",e.click(),h({type:"success",message:"下载成功"})}):h({message:"请进行拍照后再尝试下载",type:"warning"})},b=()=>{if(!s.$refs.video.srcObject)return;s.$refs.video.srcObject.getTracks().forEach(a=>{a.stop(),m.value=!1}),s.$refs.video.srcObject=null},U=()=>{navigator.mediaDevices.enumerateDevices().then(t=>{f.value=[],t.forEach(e=>{e.kind=="videoinput"&&f.value.push({label:e.label,id:e.deviceId})})}).catch(function(t){console.log(t)})},A=t=>{const e={};t===""?e.facingMode="environment":(e.deviceId={exact:t},m.value=!0);var a={video:e};V(a)},V=(t,e,a)=>{navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(t).then(l=>{s.$refs.video.srcObject=l,s.$refs.video.play()}).catch(a):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(t,e,a):navigator.mozGetUserMedia?navigator.mozGetUserMedia(t,e,a):navigator.getUserMedia&&navigator.getUserMedia(t,e,a)},F=(t,e)=>{let a=t.split(","),l=a[0].match(/:(.*?);/)[1],c=atob(a[1]),u=c.length,v=new Uint8Array(u);for(;u--;)v[u]=c.charCodeAt(u);return new File([v],e,{type:l})};U();const S=()=>{console.log(1),k.push({name:"Home"})};return(t,e)=>{const a=i("el-header"),l=i("el-button"),c=i("el-divider"),u=i("el-link"),v=i("el-tooltip"),T=i("el-aside"),L=i("el-main"),M=i("el-container"),G=i("el-dialog");return y(),D("div",Z,[o(G,{width:"80%",modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=p=>w.value=p),title:"Tips","lock-scroll":"","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":S},{default:n(()=>[o(M,null,{default:n(()=>[o(a,null,{default:n(()=>[ee]),_:1}),o(M,null,{default:n(()=>[o(T,{width:"200px"},{default:n(()=>[o(l,{onClick:B,type:"primary",plain:""},{default:n(()=>[_("开启摄像头")]),_:1}),o(l,{onClick:U,type:"primary",plain:"",disabled:""},{default:n(()=>[_("切换摄像头")]),_:1}),o(l,{onClick:b,type:"primary",plain:""},{default:n(()=>[_("关闭摄像头")]),_:1}),$(o(l,{type:"primary",onClick:j,plain:""},{default:n(()=>[_("拍照")]),_:1},512),[[I,m.value]]),$(o(l,{type:"primary",onClick:E,plain:""},{default:n(()=>[_("下载")]),_:1},512),[[I,m.value]]),o(c),(y(!0),D(H,null,P(f.value,p=>(y(),O(v,{class:"box-item",effect:"dark",content:p.label,placement:"right-end",key:p.id},{default:n(()=>[o(u,{onClick:ie=>A(p.id),underline:!1,class:"ovhd"},{default:n(()=>[_(q(p.label),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"]))),128))]),_:1}),o(L,null,{default:n(()=>[d("div",null,[te,d("canvas",ae,null,512)]),d("div",null,[oe,d("video",ne,null,512)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},le=N(se,[["__scopeId","data-v-700f6164"]]),de={__name:"index",setup(r){return(k,f)=>(y(),O(le))}};export{de as default};
