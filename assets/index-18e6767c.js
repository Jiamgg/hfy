import{_ as G,r as g,a as i,o as h,c as D,b as o,w as n,e as u,x as U,z as M,F as T,g as z,h as $,t as N,d as c,j as y,p as R,l as q,A as P}from"./index-6b169b34.js";import{r as H}from"./index-822a0e63.js";const x=m=>(R("data-v-8f2c146a"),m=m(),q(),m),J={class:"common-layout"},K=x(()=>c("h2",null,"摄像头",-1)),Q=x(()=>c("h3",null,"选定图片区",-1)),W={ref:"canvas",width:"640",height:"480"},X=x(()=>c("h3",null,"拍摄区",-1)),Y={ref:"video",width:"640",height:"480",autoplay:""},Z={__name:"Camera",setup(m){const f=g([]),d=g(!1),k=g(!0),w=g(""),{proxy:s}=P(),I=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{s.$refs.video.srcObject=e,s.$refs.video.play(),d.value=!0}).catch(e=>{y({message:"摄像头开启失败，请检查是否开启权限",type:"warning"})})},O=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});if(w.value=e.id,e){s.$refs.canvas.getContext("2d").drawImage(s.$refs.video,0,0,640,480);let a=s.$refs.canvas.toDataURL("image/jpeg",.7),l=F(a,"摄像头拍摄"),r=new FormData;r.append("files",l),r.append("module",113),H("post","http://localhost:81/dev-api/common/uploadMore",r)}}catch(e){y({message:"摄像头开启失败，请检查是否开启权限",type:"warning"});const t=navigator.userAgent;t.indexOf("Chrome")>-1?console.log("chrome://settings/content/camera"):t.indexOf("Firefox")>-1?console.log("firefox://settings/content/camera"):t.indexOf("Safari")>-1?console.log("safari://settings/content/camera"):t.indexOf("Opera")>-1?console.log("opera://settings/content/camera"):t.indexOf("Edge")>-1?console.log("edge://settings/content/camera"):console.log("无法识别的浏览器")}},j=()=>{if(w.value){let e=document.createElement("a");e.href=s.$refs.canvas.toDataURL("image/jpg",.7),e.download=new Date().getTime()+".jpeg",e.click()}else y({message:"请进行拍照后再尝试下载",type:"warning"})},A=()=>{if(!s.$refs.video.srcObject)return;s.$refs.video.srcObject.getTracks().forEach(a=>{a.stop(),d.value=!1}),s.$refs.video.srcObject=null},C=()=>{navigator.mediaDevices.enumerateDevices().then(e=>{f.value=[],e.forEach(t=>{t.kind=="videoinput"&&f.value.push({label:t.label,id:t.deviceId})})}).catch(function(e){console.log(e)})},V=e=>{const t={};e===""?t.facingMode="environment":(t.deviceId={exact:e},d.value=!0);var a={video:t};E(a)},E=(e,t,a)=>{navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e).then(l=>{s.$refs.video.srcObject=l,s.$refs.video.play()}).catch(a):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(e,t,a):navigator.mozGetUserMedia?navigator.mozGetUserMedia(e,t,a):navigator.getUserMedia&&navigator.getUserMedia(e,t,a)},F=(e,t)=>{let a=e.split(","),l=a[0].match(/:(.*?);/)[1],r=atob(a[1]),_=r.length,v=new Uint8Array(_);for(;_--;)v[_]=r.charCodeAt(_);return new File([v],t,{type:l})};return C(),(e,t)=>{const a=i("el-header"),l=i("el-button"),r=i("el-divider"),_=i("el-link"),v=i("el-tooltip"),S=i("el-aside"),B=i("el-main"),b=i("el-container"),L=i("el-dialog");return h(),D("div",J,[o(L,{width:"80%",modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=p=>k.value=p),title:"Tips","lock-scroll":""},{default:n(()=>[o(b,null,{default:n(()=>[o(a,null,{default:n(()=>[K]),_:1}),o(b,null,{default:n(()=>[o(S,{width:"200px"},{default:n(()=>[o(l,{onClick:I,type:"primary",plain:""},{default:n(()=>[u("开启摄像头")]),_:1}),o(l,{onClick:C,type:"primary",plain:"",disabled:""},{default:n(()=>[u("切换摄像头")]),_:1}),o(l,{onClick:A,type:"primary",plain:""},{default:n(()=>[u("关闭摄像头")]),_:1}),U(o(l,{type:"primary",onClick:O,plain:""},{default:n(()=>[u("拍照")]),_:1},512),[[M,d.value]]),U(o(l,{type:"primary",onClick:j,plain:""},{default:n(()=>[u("下载")]),_:1},512),[[M,d.value]]),o(r),(h(!0),D(T,null,z(f.value,p=>(h(),$(v,{class:"box-item",effect:"dark",content:p.label,placement:"right-end",key:p.id},{default:n(()=>[o(_,{onClick:te=>V(p.id),underline:!1,class:"ovhd"},{default:n(()=>[u(N(p.label),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"]))),128))]),_:1}),o(B,null,{default:n(()=>[c("div",null,[Q,c("canvas",W,null,512)]),c("div",null,[X,c("video",Y,null,512)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},ee=G(Z,[["__scopeId","data-v-8f2c146a"]]),ne={__name:"index",setup(m){return(f,d)=>(h(),$(ee))}};export{ne as default};
